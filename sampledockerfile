# -------- Build Stage --------
FROM node AS build
# FROM node:20-alpine AS build

WORKDIR /app

COPY package*.json ./
RUN npm install
# RUN npm ci

COPY . .
RUN npm run build

# -------- Runtime Stage --------
FROM nginx:1.25-alpine

# Remove default config
RUN rm /etc/nginx/conf.d/default.conf

# Custom nginx config
COPY nginx.conf /etc/nginx/conf.d/default.conf

# Copy build output
COPY --from=build /app/dist/public /usr/share/nginx/html/

# Non-root user (nginx already non-root in alpine)
EXPOSE 80

ENTRYPOINT ["nginx"]
CMD ["-g", "daemon off;"]

# docker build -t frontend-app .
# docker run -d -p 5000:80 --name frontend frontend-app
